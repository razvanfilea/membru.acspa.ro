{% extends "base.html" %}

{% block page_title %}Invitați{% endblock %}

{% block content %}

<main class="p-4 md:p-8 w-full">
    {% block list %}
    <div id="list" class="flex flex-col w-full gap-4 pb-16">
        {% for guest in guests %}
        <div id="guest_{{ guest.rowid }}"
             class="flex flex-row p-4 bg-gray-600 rounded-sm gap-4 items-center justify-between">
            <div class="flex flex-col">
                <p class="font-bold mb-2">{{ guest.name }}</p>
                <p>Data: <b>{{ guest.date.format(date_formats::READABLE_DATE).unwrap() }}</b></p>
                <p>Ora: <b>{{ guest.hour }}</b></p>
                {% if !guest.as_guest %}
                <p class="text-pink-500">Special</p>
                {% endif %}
                <p class="text-sm">Creat de {{ guest.created_by }} pe {{ date_formats::as_local(guest.created_at) }}</p>
            </div>

            {% let selected_date_formatted = guest.date.to_iso() %}

            <button
                    class="btn btn-square btn-sm btn-error btn-outline"
                    hx-delete='/reservation?date={{ selected_date_formatted }}&hour={{ guest.hour }}&user_id={{ guest.created_by_id }}&created_for={{ guest.name }}'
                    hx-target="#guest_{{ guest.rowid }}"
                    hx-swap="outerHTML"
                    hx-confirm="Ești sigur ca vrei să ștergi invitatul '{{ guest.name }}'?">
                <span class="material-symbols-outlined">delete</span>
            </button>

        </div>
        {% endfor %}
    </div>
    {% endblock %}

    <div class="fab">
        <button class="btn-main-fab group" onclick="add_modal.showModal()">
            <span class="material-symbols-outlined rotate-fab-icon">add</span>
            Adaugă invitat
        </button>
    </div>

</main>

<dialog id="add_modal" class="modal">
    <form class="modal-box"
          onsubmit="add_modal.close()"
          hx-put="/admin/guests"
          hx-target="#list"
          hx-swap="outerHTML">
        <fieldset class="fieldset gap-6" hx-target="#hour_selector" hx-trigger="change">
            <h3 class="text-lg font-bold mb-4">Adaugă invitat</h3>

            <label class="floating-label">
                <span>Nume</span>
                <input name="name" type="text" class="input input-lg input-bordered w-full" minlength="4" required/>
            </label>

            <label class="floating-label">
                <span>Data:</span>
                <input name="date" type="date" class="input input-lg input-bordered w-full" required
                       autocomplete="off" hx-post="/admin/guests/select_hour"
                       min='{{ current_date.to_iso() }}'/>
            </label>

            <div id="hour_selector"></div>

            <label class="label">
                <span class="text-lg">Special:</span>
                <input name="special" type="checkbox" class="toggle toggle-lg input-lg toggle-primary"
                       autocomplete="off"/>
            </label>

            <div class="modal-action grid grid-cols-2" hx-disinherit="*">
                <button class="btn"
                        onclick="add_modal.close()">
                    Anulează
                </button>

                <button class="btn btn-success" type="submit">
                    Adaugă
                </button>
            </div>
        </fieldset>
    </form>

    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

{% endblock %}

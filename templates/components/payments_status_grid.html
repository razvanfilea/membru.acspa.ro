<div id="status-grid-container" class="flex flex-col gap-4">
    <div class="flex flex-row justify-center">
        <div id="status-grid-years" class="join bg-base-100 border border-base-300 shadow-sm overflow-x-auto">
            {% let start_year = member.member_since.year() %}
            {% let end_year = current_year + 1 %}
            {% for year in start_year..=end_year %}
            <button
                    class="join-item btn btn-sm {% if year == selected_year %}btn-active btn-neutral{% else %}btn-ghost{% endif %}"
                    {% if member.id == user.id %}
                    hx-get="/profile/payment_status/{{ year }}"
                    {% else %}
                    hx-get="/admin/members/payment_status/{{ member.id }}/{{ year }}"
                    {% endif %}
                    hx-target="#status-grid-container"
                    hx-swap="outerHTML">
                {{ year }}
            </button>
            {% endfor %}
        </div>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
        {% for m in months_status_view %}
        <div class="flex flex-col gap-1 p-3 rounded-xl border transition-all duration-200
            {% match m.status %}
                {% when MonthStatus::Paid with (notes) %}
                    bg-success/80 border-success text-success-content
                {% when MonthStatus::Break with (reason) %}
                    bg-warning/70 border-warning text-warning-content
                {% when MonthStatus::Unpaid %}
                    bg-error/10 border-error/20 text-error
                {% when MonthStatus::NotJoined %}
                    bg-base-200 border-transparent opacity-50
                {% when MonthStatus::Future %}
                    bg-base-100 border-base-200 text-gray-400
            {% endmatch %}
        ">
            <div class="flex justify-between items-start">
                <span class="text-xs font-bold uppercase opacity-70">{{ m.month_name }}</span>

                {% match m.status %}
                {% when MonthStatus::Paid with (notes) %}
                <div class="tooltip tooltip-left" data-tip="{{ notes }}">
                    <span class="material-symbols-outlined text-lg">check_circle</span>
                </div>
                {% when MonthStatus::Break with (reason) %}
                <div class="tooltip tooltip-left" data-tip="{{ reason }}">
                    <span class="material-symbols-outlined text-lg cursor-help">pause_circle</span>
                </div>
                {% when MonthStatus::Unpaid %}
                <span class="material-symbols-outlined text-lg">cancel</span>
                {% when MonthStatus::NotJoined %}
                <span class="material-symbols-outlined text-lg">lock</span>
                {% when MonthStatus::Future %}
                <span class="material-symbols-outlined text-lg">event</span>
                {% endmatch %}
            </div>

            <div class="font-bold text-sm mt-1">
                {% match m.status %}
                {% when MonthStatus::Paid with (notes) %}
                Achitat
                {% when MonthStatus::Break with (reason) %}
                Pauză
                {% when MonthStatus::Unpaid %}
                Restanță
                {% when MonthStatus::NotJoined %}
                -
                {% when MonthStatus::Future %}
                Viitor
                {% endmatch %}
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="flex flex-wrap gap-4 justify-center text-xs text-gray-500 opacity-80 mt-2">
        <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-success"></span> Achitat</div>
        <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-warning"></span> Pauză</div>
        <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-error"></span> Restanță</div>
    </div>
</div>

<script>
(function() {
    const container = document.getElementById('status-grid-years');
    const active = container?.querySelector('.btn-active');
    if (container && active) {
        container.scrollLeft = active.offsetLeft - (container.clientWidth / 2) + (active.clientWidth / 2);
    }
})();
</script>
